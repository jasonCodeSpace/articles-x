name: Ingest Cron

on:
  schedule:
    - cron: "*/15 * * * *"   # æ¯ 15 åˆ†é’Ÿï¼ŒUTC æ—¶é—´
  workflow_dispatch: {}       # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  call:
    runs-on: ubuntu-latest
    steps:
      - name: Hit ingest endpoint (POST with header)
        run: |
          echo "ğŸš€ Triggering ingest for all 26 Twitter lists..."
          response=$(curl -sS -X POST "https://articles-x.vercel.app/api/ingest" \
            -H "x-cron-secret: $CRON_SECRET" \
            -H "Accept: application/json" \
            -w "\nHTTP_STATUS:%{http_code}")
          
          echo "$response"
          
          # Extract HTTP status code
          http_code=$(echo "$response" | grep "HTTP_STATUS:" | cut -d: -f2)
          
          # Check if request was successful
          if [ "$http_code" -eq 200 ]; then
            echo "âœ… Ingest completed successfully"
          else
            echo "âŒ Ingest failed with HTTP status: $http_code"
            exit 1
          fi
        env:
          CRON_SECRET: ${{ secrets.CRON_SECRET }}

concurrency:
  group: ingest-cron
  cancel-in-progress: false  # ä¸å–æ¶ˆæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œé¿å…æ•°æ®å¤„ç†ä¸­æ–­